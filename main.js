(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};function t(e,t,o){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(o.inactiveButtonClass)):n(t,o)}function n(e,t){e.disabled=!0,e.classList.add(t.inactiveButtonClass)}e.d({},{qp:()=>V,Av:()=>M,xS:()=>_});var o=function(e,t,n){return fetch("".concat(e.baseUrl).concat(e.id,"/cards/likes/").concat(t),{method:n,headers:{authorization:e.token}})},r={formSelector:".popup__form",inputSelector:".popup__text-input",submitButtonSelector:".popup__submit",inactiveButtonClass:"popup__submit_disabled",inputErrorClass:"popup__text-input_type_error",errorClass:"popup__error_visible"},c={token:"3666373c-6595-416d-b8ae-f698299c29e7",id:"plus-cohort-16",baseUrl:"https://nomoreparties.co/v1/"},u=document.querySelector(".element");function i(e){return e.likes.length}function a(e,t){e.textContent=t}function l(e){e.classList.toggle("like_status_active")}function s(e){if(e){var t=function(e){var t=document.querySelector("#cardTemplate").content.querySelector(".element__card").cloneNode(!0),n=t.querySelector(".element__image"),r=t.querySelector(".element__like-counter"),u=t.querySelector(".element__like");return t.querySelector(".element__title").textContent=e.name,n.src=e.link,n.alt=e.name,t.querySelector(".like").addEventListener("click",(function(t){!function(e,t,n,r){e.target.classList.contains("like_status_active")?o(c,t,"DELETE").then(V).then((function(e){a(r,i(e))})).catch((function(e){console.log(e)})):o(c,t,"PUT").then(V).then((function(e){a(r,i(e))})).catch((function(e){console.log(e)})),l(n)}(t,e._id,u,r)})),e.owner._id==_?t.querySelector(".element__remove").addEventListener("click",(function(){!function(e,t){(function(e,t){return fetch("".concat(e.baseUrl).concat(e.id,"/cards/").concat(t),{method:"DELETE",headers:{authorization:e.token}})})(c,e).then(V).then((function(){!function(e){e.remove()}(t)})).catch((function(e){console.log(e)}))}(e._id,t)})):t.removeChild(t.querySelector(".element__remove")),n.addEventListener("click",(function(e){M(n.src,n.alt)})),function(e){return e.likes.some((function(e){return e._id==_}))}(e)&&l(u),a(r,i(e)),t}(e);u.prepend(t)}}function d(e){e.classList.add("popup_opened"),document.addEventListener("mousedown",p),document.addEventListener("keydown",f)}function p(e){(e.target.classList.contains("popup")||e.target.classList.contains("popup__close-button"))&&m(e.target)}function f(e){"Escape"==e.key&&function(e){var t=e.target.closest(".popup");t&&m(t)}(e)}function m(e){e.classList.remove("popup_opened"),document.removeEventListener("mousedown",p),document.removeEventListener("keydown",f)}var _="",v=document.querySelector(".profile__name"),y=document.querySelector(".profile__about"),h=document.querySelector(".profile__avatar"),S=document.querySelector(".profile__edit-button"),b=document.querySelector(".profile__add-button"),q=document.querySelector(".profile__edit-avatar"),E=document.querySelectorAll(".popup__close"),k=document.querySelector(".image-popup"),C=k.querySelector(".popup__image"),L=k.querySelector(".popup__caption"),g=document.querySelector(".profile-popup"),x=document.getElementById("user-name"),A=document.getElementById("user-info"),B=document.getElementById("avatar-link"),T=g.querySelector(".popup__submit"),U=document.querySelector(".card-popup"),j=U.querySelector(".popup__form"),P=U.querySelector(".popup__submit"),z=document.querySelector(".edit-avatar-popup"),O=z.querySelector(".popup__form"),w=O.querySelector(".popup__submit"),D=document.getElementById("place-name"),I=document.getElementById("place-link");function N(e){e.reset()}function J(e){v.textContent=e.name,y.textContent=e.about}function H(e){h.src=e}function M(e,t){d(k),C.setAttribute("src",e),C.setAttribute("alt",t),L.textContent=t||""}function V(e){if(e.ok)return e.json();Promise.reject("Ошибка: ".concat(e.status))}E.forEach((function(e){var t=e.closest(".popup");e.addEventListener("click",(function(){return m(t)}))})),S.addEventListener("click",(function(){x.value=v.textContent,A.value=y.textContent,d(g)})),b.addEventListener("click",(function(){d(U),N(j)})),q.addEventListener("click",(function(){d(z),N(O)})),g.addEventListener("submit",(function(e){e.preventDefault();var t={};t.name=x.value,t.about=A.value,T.textContent="Сохранение...",function(e,t){return fetch("".concat(e.baseUrl).concat(e.id,"/users/me "),{method:"PATCH",headers:{authorization:e.token,"Content-Type":"application/json"},body:JSON.stringify({name:t.name,about:t.about})})}(c,t).then(V).then((function(e){J(e),m(g)})).catch((function(e){console.log(e)})).finally((function(){T.textContent="Сохранить",n(g.querySelector(".popup__submit"),r)}))})),U.addEventListener("submit",(function(e){e.preventDefault();var t={};t.name=D.value,t.link=I.value,P.textContent="Сохранение...",function(e,t){return fetch("".concat(e.baseUrl).concat(e.id,"/cards"),{method:"POST",headers:{authorization:e.token,"Content-Type":"application/json"},body:JSON.stringify({name:t.name,link:t.link})})}(c,t).then(V).then((function(e){s(e),m(U)})).finally((function(){P.textContent="Создать",n(U.querySelector(".popup__submit"),r)}))})),z.addEventListener("submit",(function(e){e.preventDefault();var t=B.value;w.textContent="Сохранение...",function(e,t){return fetch("".concat(e.baseUrl).concat(e.id,"/users/me/avatar"),{method:"PATCH",headers:{authorization:e.token,"Content-Type":"application/json"},body:JSON.stringify({avatar:t})})}(c,t).then((function(e){e.ok?(H(t),m(z)):Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)})).finally((function(){w.textContent="Сохранить",n(z.querySelector(".popup__submit"),r)}))})),function(e){var t=function(e){return fetch("".concat(e.baseUrl).concat(e.id,"/users/me "),{headers:{authorization:e.token}})}(e).then(V).then((function(e){return J(e),H(e.avatar),e._id})).catch((function(e){console.log(e)}));return t}(c).then((function(e){_=e,function(e){(function(e){return fetch("".concat(e.baseUrl).concat(e.id,"/cards"),{headers:{authorization:e.token}})})(e).then(V).then((function(e){e.forEach((function(e){s(e)}))})).catch((function(e){console.log(e)}))}(c)})).catch((function(e){console.log(e)})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(n){n.addEventListener("submit",(function(e){e.preventDefault()})),function(e,n){var o=Array.from(e.querySelectorAll(n.inputSelector)),r=e.querySelector(n.submitButtonSelector);t(o,r,n),o.forEach((function(c){c.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.error):t.setCustomValidity(""),t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(e,t,t.validationMessage,n)}(e,c,n),t(o,r,n)}))}))}(n,e)}))}(r)})();